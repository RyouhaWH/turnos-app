<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Frontend - Turnos</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .log {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin-top: 10px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Debug Frontend - Sistema de Turnos</h1>
        <p>Esta p√°gina simula el env√≠o de datos desde el frontend al backend para probar el sistema de WhatsApp.</p>
        
        <button onclick="testSendData()">üöÄ Enviar Datos de Prueba</button>
        <button onclick="testWithWhatsAppRecipients()">üì± Enviar con Destinatarios WhatsApp</button>
        <button onclick="clearLog()">üóëÔ∏è Limpiar Log</button>
        
        <div id="log" class="log">Logs aparecer√°n aqu√≠...</div>
    </div>

    <script>
        function log(message) {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.textContent += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').textContent = 'Logs aparecer√°n aqu√≠...';
        }

        async function testSendData() {
            log('üöÄ Iniciando env√≠o de datos de prueba...');
            
            const testData = {
                cambios: {
                    "1": {
                        rut: "12345678-9",
                        nombre: "Empleado Test",
                        employee_id: "1",
                        turnos: {
                            "15": "M",
                            "16": "T"
                        }
                    }
                },
                mes: 1,
                a√±o: 2025,
                comentario: "Prueba de guardado de turnos con nombres en WhatsApp",
                whatsapp_recipients: []
            };

            log('üì§ Datos a enviar: ' + JSON.stringify(testData, null, 2));

            try {
                const response = await fetch('/turnos-mes/actualizar', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]')?.getAttribute('content') || '',
                    },
                    body: JSON.stringify(testData)
                });

                log('üì• Respuesta recibida - Status: ' + response.status);
                
                if (response.ok) {
                    const result = await response.text();
                    log('‚úÖ √âxito: ' + result);
                } else {
                    log('‚ùå Error: ' + response.statusText);
                }
            } catch (error) {
                log('‚ùå Error de red: ' + error.message);
            }
        }

        async function testWithWhatsAppRecipients() {
            log('üì± Iniciando env√≠o con destinatarios WhatsApp espec√≠ficos...');
            
            const testData = {
                cambios: {
                    "87": {
                        rut: "19260115-0",
                        nombre: "Emmanuel Jacob Calfuquir Caceres",
                        employee_id: "87",
                        turnos: {
                            "2": "2"
                        }
                    }
                },
                mes: 10,
                a√±o: 2025,
                comentario: "Prueba con nombres en mensaje WhatsApp",
                whatsapp_recipients: [
                    "julio-sarmiento",
                    "marianela-huequelef",
                    "priscila-escobar",
                    "javier-alvarado",
                    "eduardo-esparza",
                    "dayana-chavez",
                    "central",
                    "manuel-verdugo",
                    "paola-carrasco",
                    "cesar-soto",
                    "cristian-montecinos",
                    "informaciones-amzoma",
                    "jorge-waltemath"
                ]
            };

            log('üì§ Datos a enviar: ' + JSON.stringify(testData, null, 2));

            try {
                const response = await fetch('/turnos-mes/actualizar', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]')?.getAttribute('content') || '',
                    },
                    body: JSON.stringify(testData)
                });

                log('üì• Respuesta recibida - Status: ' + response.status);
                
                if (response.ok) {
                    const result = await response.text();
                    log('‚úÖ √âxito: ' + result);
                    log('üîç Revisa los logs de Laravel para ver el mensaje de WhatsApp con nombres');
                } else {
                    log('‚ùå Error: ' + response.statusText);
                }
            } catch (error) {
                log('‚ùå Error de red: ' + error.message);
            }
        }

        // Auto-log al cargar la p√°gina
        window.onload = function() {
            log('üåê P√°gina de debug cargada');
            log('üí° Haz clic en "Enviar con Destinatarios WhatsApp" para probar los nombres en el mensaje');
        };
    </script>
</body>
</html>